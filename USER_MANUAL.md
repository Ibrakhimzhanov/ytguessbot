# 📱 Руководство пользователя - Telegram Bot для курса

## 📋 Содержание
- [Для обычных пользователей](#для-обычных-пользователей)
- [Для администраторов](#для-администраторов)
- [Команды бота](#команды-бота)
- [Часто задаваемые вопросы](#часто-задаваемые-вопросы)

---

## 👥 ДЛЯ ОБЫЧНЫХ ПОЛЬЗОВАТЕЛЕЙ

### 🚀 Начало работы

#### 1. Запуск бота

Отправьте команду `/start` или нажмите кнопку **"Start"** в Telegram.

**Что происходит:**
- Бот регистрирует вас в системе
- Показывает приветственное сообщение
- Отображает главное меню

---

### 🎯 Главное меню

После запуска бота вы увидите 4 кнопки:

```
┌─────────────────────────────┐
│  📚 Купить курс             │
│  💰 Проверить оплату        │
├─────────────────────────────┤
│  📞 Контакты                │
│  📋 О курсе                 │
└─────────────────────────────┘
```

---

### 📚 Купить курс

**Что делает:** Начинает процесс покупки курса

**Шаги:**

1. **Нажмите кнопку "📚 Купить курс"**

2. **Поделитесь номером телефона**
   - Бот попросит ваш номер телефона
   - Нажмите кнопку **"📱 Поделиться номером телефона"**
   - Telegram автоматически отправит ваш номер

3. **Информация о курсе**
   - Стоимость: **11,000 сум**
   - Что входит:
     - ✅ Все видео уроки
     - ✅ Практические задания
     - ✅ Поддержка куратора
     - ✅ Сертификат об окончании

4. **Выберите способ оплаты**
   - Кнопка: **"💳 Оплатить через Payme"**

5. **Оплата**
   - Бот отправит ссылку для оплаты
   - Откройте ссылку в браузере
   - Выберите способ оплаты:
     - 💳 **Банковская карта**
     - 📱 **Payme кошелек**
   - Нажмите **"✅ Успешно"** после оплаты
   - Или **"❌ Отменить"** чтобы отменить

6. **После оплаты**
   - Вернитесь в бота
   - Нажмите **"✅ Я оплатил"**
   - Бот автоматически проверит оплату
   - Получите доступ к курсу

---

### 💰 Проверить оплату

**Что делает:** Показывает ваш статус оплаты и информацию о платежах

**Информация:**
- ✅ **Статус доступа** к курсу (Оплачен / Не оплачен)
- 👤 Ваше имя
- 📱 Ваш телефон
- 📋 Информация о последнем платеже:
  - Номер заказа
  - Дата оплаты
  - Сумма
  - Статус

**Пример:**
```
📊 Ваш статус

👤 Имя: Алишер Каримов
📱 Телефон: +998941234567
✅ Доступ к курсу: Оплачен

📋 Последний платеж: #1001
📅 Дата: 03.10.2025
💰 Сумма: 11,000 сум
🔖 Статус: ✅ Оплачен

📚 Используйте /mycourse для доступа к материалам
```

---

### 📋 О курсе

**Что делает:** Показывает подробную информацию о курсе

**Информация:**
- 📚 Название курса
- 💰 Стоимость
- ⏱ Длительность
- 📝 Что входит в курс
- 🎓 Что вы получите после окончания

---

### 📞 Контакты

**Что делает:** Показывает контакты для связи

**Контактная информация:**
- 📧 Email
- 📱 Телефон поддержки
- 💬 Telegram администратора
- 🌐 Сайт (если есть)

---

### 📚 Доступ к материалам курса

**Команда:** `/mycourse`

**Что делает:** Открывает доступ к материалам курса (только для оплативших)

**Доступные разделы:**
```
┌─────────────────────────────┐
│  📹 Видеоуроки              │
│  📝 Материалы               │
├─────────────────────────────┤
│  ✍️ Задания                 │
│  💬 Чат с куратором         │
├─────────────────────────────┤
│  🏆 Сертификат              │
└─────────────────────────────┘
```

**Если не оплачено:**
- Бот покажет сообщение о необходимости оплаты
- Предложит купить курс

---

## 👑 ДЛЯ АДМИНИСТРАТОРОВ

### 🔐 Доступ к админ-панели

**Кто имеет доступ:**
- 👑 **Owner** (Владелец) - полный доступ
- 🔧 **Admin** (Администратор) - доступ к админ-панели

**Как войти:**
1. Отправьте `/start` боту
2. Если у вас есть права администратора, вы увидите кнопку **"🔧 Админ-панель"**
3. Нажмите на неё

---

### 🎛️ Админ-панель

```
┌─────────────────────────────────┐
│  🔔 Управление розыгрышем      │
│  🗂 Экспорт XLSX               │
├─────────────────────────────────┤
│  🎁 Выбрать победителя         │
│  🏆 История розыгрышей         │
├─────────────────────────────────┤
│  🧾 Чек по userId              │
│  📊 Статистика                 │
├─────────────────────────────────┤
│  🔙 Назад в главное меню       │
└─────────────────────────────────┘
```

---

### 📊 Статистика

**Кнопка:** "📊 Статистика"  
**Команда:** `/admin_stats`

**Что показывает:**
```
📊 Статистика бота

👥 Пользователи:
• Всего: 52
• Оплативших: 30 (58%)
• Не оплативших: 22

💳 Платежи:
• Всего: 35
• Оплачено: 30
• В ожидании: 5

💰 Доход:
• Общий: 330,000 сум
```

**Информация:**
- 👥 **Количество пользователей** (всего, оплатили, не оплатили)
- 💳 **Статистика платежей** (всего, оплачено, в ожидании)
- 💰 **Общий доход** в сумах
- 📈 **Процент конверсии** (сколько % оплатило)

---

### 🗂 Экспорт XLSX

**Кнопка:** "🗂 Экспорт XLSX"

**Что делает:** Генерирует Excel файл со всеми пользователями

**Формат файла:**

| User ID | Имя | Телефон (маска) | Username | Дата оплаты | Статус |
|---------|-----|-----------------|----------|-------------|---------|
| a1b2c3d4... | Алишер Каримов | +9989X *** ** 67 | @alisher_karimov | 01.10.2025, 12:00 | ✅ Оплачено |
| e5f6g7h8... | Камила Азимова | +9989X *** ** 45 | @kamila_azimova | - | ⏳ Не оплачено |

**Особенности:**
- 🔒 **Телефоны замаскированы** для безопасности
  - Формат: `+998XX *** ** NN`
  - Показаны только код оператора и последние 2 цифры
- 📅 **Дата регистрации** и дата оплаты
- 🎨 **Цветное оформление:**
  - Зеленый фон - оплатившие
  - Желтый фон - не оплатившие
- 📏 **Автоширина колонок**

**Имя файла:** `users_export_YYYY-MM-DD_HH-MM-SS.xlsx`

**Использование:**
1. Нажмите кнопку "🗂 Экспорт XLSX"
2. Подождите 2-5 секунд (зависит от количества пользователей)
3. Получите файл документом в Telegram
4. Скачайте и откройте в Excel / Google Sheets

---

### 🎰 Управление розыгрышем

**Кнопка:** "🔔 Управление розыгрышем"

**Что делает:** Включает/выключает автоматическое участие в розыгрыше

**Статусы:**
- 🔔 **Активен** - все оплатившие пользователи автоматически участвуют
- ⏹ **Остановлен** - новые оплатившие не добавляются в розыгрыш

**Как управлять:**

1. **Нажмите** "🔔 Управление розыгрышем"
2. **Увидите текущий статус:**
```
🎰 Управление розыгрышем

Текущий статус: 🔔 Активен

Розыгрыш активен. Пользователи могут участвовать 
после оплаты.

┌─────────────────────────┐
│  ⏹ Остановить розыгрыш │
│  🔙 Назад               │
└─────────────────────────┘
```

3. **Нажмите кнопку** для переключения статуса

**Когда использовать:**
- 🔔 **Включите** перед началом акции/розыгрыша
- ⏹ **Остановите** перед выбором победителя
- ⏹ **Остановите** когда розыгрыш завершен

---

### 🎁 Выбрать победителя

**Кнопка:** "🎁 Выбрать победителя"

**Что делает:** Случайным образом выбирает победителя среди оплативших пользователей

**Процесс:**

1. **Нажмите** "🎁 Выбрать победителя"

2. **Проверка участников:**
   - Система проверит наличие оплативших пользователей
   - Если нет участников - покажет ошибку

3. **Анимация выбора:**
```
🎰 Выбираю победителя...

👤 Алишер Каримов
📱 +9989X *** ** 45
🆔 @alisher_karimov
```
   - Показывает случайных участников
   - Длится ~2 секунды
   - 8 шагов анимации

4. **Результат:**
```
🎉 ПОБЕДИТЕЛЬ ВЫБРАН!

👤 Имя: Камила Азимова
📱 Телефон: +9989X *** ** 67
🆔 Username: @kamila_azimova
🎁 Приз: Главный приз

Поздравляем! 🎊
```

5. **Автоматические действия:**
   - ✅ Победитель сохраняется в базу данных
   - 📱 Победитель получает уведомление в Telegram
   - 📋 Запись добавляется в историю

**Требования:**
- Должен быть минимум 1 пользователь с `isPaid = true`
- Розыгрыш не должен быть заблокирован (подождите 2-3 секунды между розыгрышами)

**Уведомление победителю:**
```
🎉 Поздравляем!

Вы стали победителем розыгрыша!
Скоро с вами свяжется администратор для 
вручения приза.
```

---

### 🏆 История розыгрышей

**Кнопка:** "🏆 История розыгрышей"

**Что показывает:** Последние 10 розыгрышей с информацией о победителях

**Формат:**
```
🏆 История розыгрышей (последние 10)

1. 03.10.2025, 15:30:45
👤 Алишер Каримов
📱 +9989X *** ** 45
🎁 Главный приз

2. 01.10.2025, 18:20:10
👤 Камила Азимова
📱 +9989X *** ** 67
🎁 Главный приз

3. 28.09.2025, 12:15:30
👤 Отабек Юсупов
📱 +9989X *** ** 89
🎁 Главный приз
```

**Информация:**
- 📅 Дата и время розыгрыша
- 👤 ФИО победителя
- 📱 Замаскированный телефон
- 🎁 Приз

**Использование:**
- Проверка прошлых розыгрышей
- Контроль честности (нет повторов)
- Архив для отчетности

---

### 🧾 Чек по userId

**Кнопка:** "🧾 Чек по userId"

**Что делает:** Показывает подробную информацию о конкретном пользователе

**Как использовать:**

1. **Нажмите** "🧾 Чек по userId"

2. **Выберите опцию:**
```
┌─────────────────────────────┐
│  🎲 Сгенерировать рандомный │
│     чек Payme               │
│  🔙 Назад                   │
└─────────────────────────────┘
```

**Опция 1: Проверка по UUID**

3. **Скопируйте User ID** из XLSX экспорта
   - Формат: `a1b2c3d4-e5f6-7890-abcd-ef1234567890`

4. **Отправьте UUID** боту

5. **Получите информацию:**
```
🧾 Информация о пользователе

👤 Имя: Алишер Каримов
📱 Телефон: +9989X *** ** 67
🆔 Username: @alisher_karimov
💳 Статус: ✅ Оплачен
📅 Регистрация: 01.10.2025, 12:30:45

💰 Платежи (последние 5):

✅ #1001 - 11,000 сум
   01.10.2025, 12:35:20
   Оплачен: 01.10.2025, 12:36:15

✅ #1002 - 11,000 сум
   05.10.2025, 15:20:10
   Оплачен: 05.10.2025, 15:21:45
```

**Опция 2: Генерация рандомного чека Payme**

3. **Нажмите** "🎲 Сгенерировать рандомный чек"

4. **Получите тестовый чек:**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
          💳 ЭЛЕКТРОННЫЙ ЧЕК PAYME
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 Информация о платеже:
   • Номер чека: 123456
   • ID транзакции: 123456789012
   • Статус: ✅ Успешно выполнен

📤 ОТПРАВИТЕЛЬ (Плательщик):
   👤 ФИО: Алишер Каримов
   💳 Карта: 8600 **** **** 1234
   🏦 Банк: Не указан

📥 ПОЛУЧАТЕЛЬ:
   🏢 Организация: IT Course Academy
   💳 Карта: 5614 **** **** 5678

💰 ДЕТАЛИ ПЛАТЕЖА:
   Сумма перевода:     11,000 сум
   Комиссия Payme:     0 сум
   ──────────────────────────────────
   ИТОГО К ОПЛАТЕ:     11,000 сум

📅 Дата и время:
   • Дата: 03.10.2025
   • Время: 15:30:45

⚠️ Это тестовый чек для демонстрации.
```

**Использование:**
- 🔍 Проверка конкретного пользователя
- 💳 Проверка истории платежей
- 🧾 Генерация демо-чеков для клиента

---

### 🔙 Назад в главное меню

**Кнопка:** "🔙 Назад в главное меню"

**Что делает:** Возвращает в главное меню

**После нажатия:**
- Админ увидит обычное меню + кнопку "🔧 Админ-панель"
- Можно пользоваться обычными функциями
- Можно снова войти в админ-панель

---

## 🎮 КОМАНДЫ БОТА

### Для всех пользователей:

| Команда | Описание |
|---------|----------|
| `/start` | Запуск бота, регистрация, главное меню |
| `/help` | Показать список всех команд |
| `/buy` | Купить курс |
| `/status` | Проверить статус оплаты |
| `/mycourse` | Доступ к материалам курса (только для оплативших) |

### Для администраторов:

| Команда | Описание |
|---------|----------|
| `/admin_stats` | Статистика бота (пользователи, платежи, доход) |

---

## 🎯 СЦЕНАРИИ ИСПОЛЬЗОВАНИЯ

### Сценарий 1: Новый пользователь покупает курс

1. Пользователь находит бота в Telegram
2. Нажимает **Start** или отправляет `/start`
3. Бот регистрирует пользователя
4. Пользователь нажимает **"📚 Купить курс"**
5. Делится номером телефона
6. Нажимает **"💳 Оплатить через Payme"**
7. Открывает ссылку в браузере
8. Вводит данные карты и оплачивает
9. Нажимает **"✅ Успешно"** на странице оплаты
10. Возвращается в бота
11. Нажимает **"✅ Я оплатил"**
12. Бот проверяет оплату
13. ✅ Получает доступ к курсу
14. Может использовать `/mycourse` для обучения

---

### Сценарий 2: Админ экспортирует список пользователей

1. Админ открывает бота
2. Нажимает **"🔧 Админ-панель"**
3. Нажимает **"🗂 Экспорт XLSX"**
4. Ждет 2-5 секунд
5. Получает Excel файл
6. Скачивает файл
7. Открывает в Excel
8. Видит всех пользователей с замаскированными телефонами
9. Может фильтровать по статусу (оплатил/не оплатил)
10. Использует для аналитики/отчетности

---

### Сценарий 3: Админ проводит розыгрыш

1. **Подготовка:**
   - Админ открывает **"🔧 Админ-панель"**
   - Нажимает **"📊 Статистика"** - проверяет количество участников
   - Должно быть минимум 1 оплативший пользователь

2. **Активация розыгрыша:**
   - Нажимает **"🔔 Управление розыгрышем"**
   - Убеждается что статус: **🔔 Активен**
   - Если не активен - нажимает **"🔔 Включить розыгрыш"**

3. **Выбор победителя:**
   - Нажимает **"🎁 Выбрать победителя"**
   - Смотрит анимацию выбора (2 секунды)
   - Видит результат с данными победителя

4. **Связь с победителем:**
   - Победитель автоматически получает уведомление
   - Админ копирует username победителя
   - Пишет победителю в Telegram
   - Договаривается о вручении приза

5. **Проверка истории:**
   - Нажимает **"🏆 История розыгрышей"**
   - Проверяет что победитель записан
   - Сохраняет информацию для отчета

---

### Сценарий 4: Админ проверяет конкретного пользователя

1. Админ получает жалобу от пользователя
2. Открывает **"🔧 Админ-панель"**
3. Нажимает **"🗂 Экспорт XLSX"**
4. Находит пользователя в Excel файле
5. Копирует его User ID
6. В админ-панели нажимает **"🧾 Чек по userId"**
7. Отправляет User ID боту
8. Получает полную информацию:
   - Имя, телефон, username
   - Статус оплаты
   - Историю всех платежей
9. Проверяет причину проблемы
10. Решает вопрос пользователя

---

## ❓ ЧАСТО ЗАДАВАЕМЫЕ ВОПРОСЫ

### Для пользователей:

**Q: Как купить курс?**  
A: Нажмите "📚 Купить курс" → Поделитесь телефоном → "💳 Оплатить через Payme" → Оплатите → "✅ Я оплатил"

**Q: Какие способы оплаты принимаются?**  
A: Через Payme - банковские карты Visa/Mastercard/Uzcard/Humo и Payme кошелек

**Q: Сколько стоит курс?**  
A: 11,000 сум

**Q: Как получить доступ к материалам?**  
A: После оплаты используйте команду `/mycourse`

**Q: Могу ли я вернуть деньги?**  
A: Свяжитесь с администратором через кнопку "📞 Контакты"

**Q: Участвую ли я в розыгрыше?**  
A: Да, если вы оплатили курс, вы автоматически участвуете

**Q: Как узнать выиграл ли я?**  
A: Если вы победите, бот автоматически отправит вам уведомление

---

### Для администраторов:

**Q: Как добавить нового администратора?**  
A: Добавьте его Telegram ID в файл `.env` в переменную `ADMIN_IDS`

**Q: Как удалить администратора?**  
A: Удалите его Telegram ID из `.env` и перезапустите бота

**Q: Безопасны ли данные в XLSX?**  
A: Да, телефоны замаскированы. Показаны только код оператора и последние 2 цифры

**Q: Можно ли провести несколько розыгрышей?**  
A: Да, можно проводить неограниченное количество. История сохраняется

**Q: Как проверить что оплата прошла?**  
A: Нажмите "📊 Статистика" - увидите количество оплаченных платежей

**Q: Что делать если победитель не отвечает?**  
A: Проведите новый розыгрыш. Система выберет другого участника

**Q: Можно ли исключить пользователя из розыгрыша?**  
A: Да, через базу данных установите `isPaid = false` для этого пользователя

**Q: Как часто можно проводить розыгрыш?**  
A: Без ограничений, но рекомендуется подождать 2-3 секунды между розыгрышами

---

## 🔒 БЕЗОПАСНОСТЬ

### Защита данных:

- 🔐 **Телефоны маскируются** в экспорте XLSX
- 🔐 **Доступ к админ-панели** только по Telegram ID
- 🔐 **Платежи через Payme** - безопасная обработка
- 🔐 **Данные в PostgreSQL** - защищенная база данных

### Рекомендации:

- ✅ Не делитесь XLSX файлами с посторонними
- ✅ Не публикуйте User ID пользователей
- ✅ Регулярно делайте backup базы данных
- ✅ Не добавляйте незнакомых людей в админы

---

## 📞 ПОДДЕРЖКА

### Если что-то не работает:

1. **Для пользователей:**
   - Нажмите "📞 Контакты" в боте
   - Свяжитесь с администратором

2. **Для администраторов:**
   - Проверьте логи: `pm2 logs ytguessbot`
   - Проверьте webhook: `node check-webhook.js`
   - Посмотрите документацию: `QUICK_FIX.md`

---

## 📊 СТАТИСТИКА И АНАЛИТИКА

### Метрики для отслеживания:

- 👥 **Количество пользователей** (рост базы)
- 💳 **Конверсия в оплату** (% оплативших)
- 💰 **Средний чек** (обычно 11,000 сум)
- 📈 **Динамика регистраций** (по датам в XLSX)
- 🎰 **Активность розыгрышей** (в истории)

### Как анализировать:

1. Регулярно экспортируйте XLSX
2. Проверяйте статистику каждый день
3. Сравнивайте показатели по неделям/месяцам
4. Корректируйте маркетинг на основе данных

---

**Версия:** 1.0.0  
**Дата:** 10 января 2025  
**Контакты:** @ibrakhimzhanovit

---

## 🎉 ГОТОВО!

Теперь вы знаете все функции бота!

- 👥 Пользователи могут легко купить курс и получить доступ
- 👑 Администраторы имеют полный контроль и аналитику
- 🎰 Розыгрыши проводятся честно и прозрачно
- 📊 Вся статистика под рукой

**Удачи с вашим курсом!** 🚀
