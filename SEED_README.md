# 🌱 Инструкция по заполнению базы тестовыми данными

## 📋 Что создаст скрипт

Скрипт создаст **50 пользователей** с реалистичными данными:

- ✅ **30 пользователей** (60%) - оплатили курс (участвуют в розыгрыше)
- ❌ **20 пользователей** (40%) - не оплатили

### Данные пользователей:

- 📱 **Телефон**: +998 94/93/55/90/91/88/78 XXX XX XX (реальные узбекские операторы)
- 👤 **Имена**: Узбекские имена (Алишер, Камила, Отабек, Динара и т.д.)
- 📝 **Фамилии**: Узбекские фамилии (Каримов, Усманов, Рахимов и т.д.)
- 🆔 **Username**: Генерируется из имени/фамилии + число (alisher_karimov123)
- 💳 **Статус**: isPaid = true/false (случайно)
- 🆔 **Telegram ID**: Рандомный (100000000-999999999)

### Платежи:

Для каждого оплатившего пользователя создается:
- 💰 **Сумма**: 1,100,000 тийинов (11,000 сум)
- 💳 **Статус**: PAID
- 📅 **Дата**: Случайная в последние 30 дней
- 🧾 **Receipt ID**: mock_receipt_XXXXXX

---

## 🚀 Как запустить

### На сервере:

```bash
# 1. Перейдите в директорию проекта
cd /srv/postgres/ytguessbot

# 2. Запустите seed скрипт
npm run seed
```

### Локально:

```bash
# 1. Убедитесь что .env настроен правильно
cat .env | grep DATABASE_URL

# 2. Запустите seed
npm run seed
```

---

## 📊 Пример вывода

```
🌱 Начинаем заполнение базы данных...

🗑️  Очистка старых данных...
✅ Данные очищены

1. ✅ Алишер Каримов (@alisher_karimov123) - +998941234567
2. ❌ Камила Усманова (@kamila_usmanova456) - +998931234567
3. ✅ Отабек Рахимов (@otabek_rahimov789) - +998551234567
...
50. ✅ Динара Алиева (@dinara_alieva321) - +998781234567

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 СТАТИСТИКА:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
👥 Всего пользователей: 50
✅ Оплативших (участвуют в розыгрыше): 30
❌ Не оплативших: 20
💳 Платежей создано: 30
💰 Общая сумма: 330,000 сум
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎰 Участники розыгрыша:
  1. Алишер Каримов (@alisher_karimov123)
  2. Отабек Рахимов (@otabek_rahimov789)
  3. Санжар Набиев (@sanjar_nabiev234)
  ...

✅ База данных успешно заполнена!

💡 Теперь можете:
   1. Запустить бота
   2. Войти в админ-панель
   3. Экспортировать XLSX
   4. Провести розыгрыш среди оплативших пользователей
```

---

## ⚠️ ВАЖНО

### Скрипт удаляет существующие данные!

При запуске скрипт **очищает**:
- ❌ Всех пользователей
- ❌ Все платежи
- ❌ Всех победителей розыгрыша

### Если хотите сохранить существующие данные:

**НЕ ЗАПУСКАЙТЕ** этот скрипт! Или закомментируйте строки:

```typescript
// await prisma.payment.deleteMany({})
// await prisma.lotteryWinner.deleteMany({})
// await prisma.user.deleteMany({})
```

---

## 🧪 Проверка данных

### После запуска seed проверьте:

```bash
# 1. Подключитесь к БД
psql "$DATABASE_URL"

# 2. Проверьте пользователей
SELECT 
  "firstName", 
  "fullName", 
  "phoneNumber", 
  username, 
  "isPaid"
FROM users
LIMIT 10;

# 3. Проверьте платежи
SELECT 
  u."fullName",
  p."orderNumber",
  p.amount,
  p.status,
  p."createdAt"
FROM payments p
JOIN users u ON p."userId" = u.id
ORDER BY p."createdAt" DESC
LIMIT 10;

# 4. Подсчитайте участников розыгрыша
SELECT COUNT(*) FROM users WHERE "isPaid" = true;
```

---

## 🎯 Что делать дальше

### 1. Экспорт XLSX

```
1. Запустите бота
2. Отправьте /start
3. Нажмите "🔧 Админ-панель"
4. Нажмите "🗂 Экспорт XLSX"
5. Получите файл с 50 пользователями
```

### 2. Проведите розыгрыш

```
1. Админ-панель → "🎁 Выбрать победителя"
2. Система автоматически выберет из 30 оплативших
3. Победитель получит уведомление
4. Результат сохранится в историю
```

### 3. Проверьте статистику

```
1. Админ-панель → "📊 Статистика"
2. Или команда: /admin_stats
```

Должно показать:
```
📊 Статистика бота

👥 Пользователи:
• Всего: 50
• Оплативших: 30 (60%)
• Не оплативших: 20

💳 Платежи:
• Всего: 30
• Оплачено: 30
• В ожидании: 0

💰 Доход:
• Общий: 330,000 сум
```

---

## 🔄 Запуск заново

Если хотите пересоздать данные:

```bash
# Просто запустите снова
npm run seed

# Все данные будут удалены и созданы заново
```

---

## 🛠️ Кастомизация

### Изменить количество пользователей

В файле `prisma/seed.ts` измените:

```typescript
// Было: 50 пользователей
for (let i = 0; i < 50; i++) {

// Стало: 100 пользователей
for (let i = 0; i < 100; i++) {
```

### Изменить процент оплативших

```typescript
// Было: 60% оплатили
const isPaid = Math.random() < 0.6

// Стало: 80% оплатили
const isPaid = Math.random() < 0.8
```

### Изменить сумму платежа

```typescript
// Было: 11,000 сум
amount: 1100000,

// Стало: 50,000 сум
amount: 5000000,
```

### Добавить свои имена

```typescript
const uzbekNames = {
  male: [
    'Алишер', 'Азиз', 'Бобур',
    'МоеИмя1', 'МоеИмя2'  // ← добавьте сюда
  ],
  female: [
    'Азиза', 'Гулнора', 'Динара',
    'МоеИмя3', 'МоеИмя4'  // ← добавьте сюда
  ]
}
```

---

## 📞 Если что-то не работает

### Ошибка: "Cannot find module 'tsx'"

```bash
npm install tsx --save-dev
npm run seed
```

### Ошибка: "Cannot find module '@prisma/client'"

```bash
npx prisma generate
npm run seed
```

### Ошибка подключения к БД

```bash
# Проверьте DATABASE_URL
cat .env | grep DATABASE_URL

# Проверьте что PostgreSQL запущен
systemctl status postgresql
```

---

**Готово!** 🎉

Теперь у вас 50 реалистичных пользователей для тестирования бота и админ-панели!
