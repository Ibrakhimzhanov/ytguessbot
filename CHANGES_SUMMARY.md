# üìù –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π Payme

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–û–±–Ω–æ–≤–ª–µ–Ω `src/lib/bot-handlers.ts`**
- ‚ùå –£–¥–∞–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `createMockPaymeService`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `generatePaymeCheckoutUrl`
- ‚úÖ –£–¥–∞–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è mock —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è payment URL –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π Payme checkout
- ‚úÖ –£–±—Ä–∞–Ω—ã –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è "–¢–ï–°–¢" –∏ "(Mock)" –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ" —Å –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–æ–π –Ω–∞ Payme

### 2. **–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª `src/lib/payme/payme-utils.ts`**
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `generatePaymeCheckoutUrl()` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç URL –¥–ª—è Payme checkout
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `verifyPaymeAuth()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –æ—Ç Payme
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `generateTransactionId()` - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω `src/app/api/payme/billing/route.ts`**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –±–æ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –ø–ª–∞—Ç–µ–∂–∞

### 4. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ü–µ–Ω–∞ –∫—É—Ä—Å–∞ –≤ `.env` —Ñ–∞–π–ª–µ**
- ‚úÖ –¶–µ–Ω–∞: `250000000` —Ç–∏–π–∏–Ω–æ–≤ (2,500,000 —Å—É–º)

### 5. **–°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
- ‚úÖ `REAL_PAYME_INTEGRATION.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `CHANGES_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª —Å –∫—Ä–∞—Ç–∫–∏–º –æ–ø–∏—Å–∞–Ω–∏–µ–º

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –§–∞–π–ª | –î–µ–π—Å—Ç–≤–∏–µ | –°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ |
|------|----------|----------------|
| `src/lib/bot-handlers.ts` | –û–±–Ω–æ–≤–ª–µ–Ω | ~30 |
| `src/lib/payme/payme-utils.ts` | –°–æ–∑–¥–∞–Ω | ~50 |
| `src/app/api/payme/billing/route.ts` | –û–±–Ω–æ–≤–ª–µ–Ω | ~20 |
| `.env` | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω | 1 |
| `REAL_PAYME_INTEGRATION.md` | –°–æ–∑–¥–∞–Ω | ~400 |
| `CHANGES_SUMMARY.md` | –°–æ–∑–¥–∞–Ω | ~50 |

**–í—Å–µ–≥–æ:** ~550 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üîÑ Diff –æ—Å–Ω–æ–≤–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

### `src/lib/bot-handlers.ts`

```diff
- import { createMockPaymeService } from './payme/payme-mock'
+ import { generatePaymeCheckoutUrl } from './payme/payme-utils'

- const mockPayme = createMockPaymeService()
  const COURSE_PRICE = parseInt(process.env.COURSE_PRICE || '2500000')
+ const PAYME_MERCHANT_ID = process.env.PAYME_X_AUTH?.split(':')[0] || ''
+ const IS_TEST_MODE = process.env.NODE_ENV !== 'production'

  // –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ pay_payme:
- const { receipt } = await mockPayme.createCourseReceipt(...)
- const paymentUrl = mockPayme.getMockPaymentUrl(...)
+ const paymentUrl = generatePaymeCheckoutUrl(
+   PAYME_MERCHANT_ID,
+   { order_id: payment.orderNumber.toString(), user_id: user.id },
+   COURSE_PRICE,
+   IS_TEST_MODE
+ )

  // –í —Å–æ–æ–±—â–µ–Ω–∏–∏:
- [Markup.button.callback('üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Payme (–¢–ï–°–¢)', 'pay_payme')]
+ [Markup.button.callback('üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Payme', 'pay_payme')]
+ [Markup.button.url('üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ', paymentUrl)]
```

### `src/app/api/payme/billing/route.ts`

```diff
  import { prisma } from '@/lib/prisma'
+ import { bot } from '@/lib/telegram'

  async function performTransaction(params: any) {
    // ... –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ ...
    
+   // –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
+   try {
+     await bot.telegram.sendMessage(
+       payment.user.telegramId.toString(),
+       `üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à –ø–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!...`
+     )
+   } catch (error) {
+     console.error('Failed to notify user:', error)
+   }
  }
```

### `.env`

```diff
# –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –∫—É—Ä—Å–∞:
COURSE_PRICE=250000000  # –≤ —Ç–∏–π–∏–Ω–∞—Ö (2,500,000 —Å—É–º) ‚úÖ
```

---

## üîê –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ credentials

```env
# –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á (—Å–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–µ–Ω):
PAYME_X_AUTH=68dfaed6eb0789cb092fb03e:GjdJQHqcqjYFmZDpjhbM#rXdYAPq7XnB0GyM

# Production –∫–ª—é—á (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):
PAYME_X_AUTH=68dfaed6eb0789cb092fb03e:34Gsv3pFKZsGXYe2oyAyuzq%b0dxz?UGsg&e
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ

- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ Next.js build —É—Å–ø–µ—à–µ–Ω
- ‚úÖ –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ URL —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–æ—Ç–æ–≤
- ‚úÖ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ test —Ä–µ–∂–∏–º–µ:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
   - –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
   - –û–ø–ª–∞—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–æ–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook –æ—Ç Payme:**
   - –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Payme –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ `https://ytacademy.uz/api/payme/billing`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

3. **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –ó–∞–º–µ–Ω–∏—Ç—å test –∫–ª—é—á –Ω–∞ production –∫–ª—é—á –≤ `.env`
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –ì–æ—Ç–æ–≤–æ! üéâ

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `pm2 logs ytguessbot`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: `REAL_PAYME_INTEGRATION.md`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Payme –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: https://developer.help.paycom.uz/

---

**–î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π:** 10 —è–Ω–≤–∞—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0 (–†–µ–∞–ª—å–Ω—ã–π Payme)
